#platform "GOLDELOX"

/*     4DGL Demo Application
       - Digital Clock with Date and rotating messages -
       -- GOLDELOX Platform --
*/

#inherit "4DGL_16bitColours.fnc"

// define a custom font.
// Custom fonts can also be placed in MEDIA (ie on uSD card), however
// text blitting will run much faster from a data statement.
#DATA
    byte MS_SanSerif8x12
    2,                                                          // Type 2, Char Width preceeds character; Table of widths also
    96,                                                         // Num chars
    32,                                                         // Starting Char
    8,                                                          // Font_Width
    12,                                                         // Font_Height
    4, 4, 6, 8, 7, 8, 7, 3,                                     // Widths of chars 0x32 to 0x39
    4, 4, 5, 7, 4, 4, 4, 6,                                     // etc.
    7, 7, 7, 7, 7, 7, 7, 7,
    7, 7, 4, 4, 7, 7, 7, 7,
    8, 8, 8, 8, 8, 8, 7, 8,
    8, 4, 6, 8, 7, 8, 8, 8,
    8, 8, 8, 8, 8, 8, 8, 8,
    8, 8, 8, 4, 6, 4, 7, 7,
    4, 7, 7, 7, 7, 7, 4, 7,
    7, 3, 3, 7, 3, 9, 7, 7,
    7, 7, 4, 6, 4, 7, 7, 8,
    6, 6, 6, 5, 3, 5, 8, 4,
    4, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,   // 32 ' '
    4, 0x00, 0x00, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x00, 0x40, 0x00,   // 33 '!'
    6, 0x00, 0x00, 0x48, 0x48, 0x48, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,   // 34 '"'
    8, 0x00, 0x00, 0x24, 0x24, 0x7E, 0x24, 0x24, 0x24, 0x7E, 0x24, 0x24, 0x00,   // 35 '#'
    7, 0x00, 0x00, 0x10, 0x38, 0x54, 0x50, 0x30, 0x18, 0x14, 0x54, 0x38, 0x10,   // 36 '$'
    8, 0x00, 0x00, 0x30, 0x49, 0x32, 0x04, 0x08, 0x10, 0x26, 0x49, 0x06, 0x00,   // 37 '%'
    7, 0x00, 0x00, 0x20, 0x50, 0x50, 0x20, 0x20, 0x54, 0x48, 0x48, 0x34, 0x00,   // 38 '&'
    3, 0x00, 0x00, 0x40, 0x40, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,   // 39 '''
    4, 0x00, 0x00, 0x20, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40,   // 40 '('
    4, 0x00, 0x00, 0x40, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,   // 41 ')'
    5, 0x00, 0x00, 0x00, 0x50, 0x20, 0x50, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,   // 42 '*'
    7, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x10, 0x7C, 0x10, 0x10, 0x00, 0x00,   // 43 '+'
    4, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x40,   // 44 ','
    4, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00, 0x00,   // 45 '-'
    4, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00,   // 46 '.'
    6, 0x00, 0x00, 0x08, 0x08, 0x08, 0x10, 0x10, 0x20, 0x20, 0x40, 0x40, 0x00,   // 47 '/'
    7, 0x00, 0x00, 0x38, 0x44, 0x44, 0x44, 0x44, 0x44, 0x44, 0x44, 0x38, 0x00,   // 48 '0'
    7, 0x00, 0x00, 0x10, 0x70, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x00,   // 49 '1'
    7, 0x00, 0x00, 0x38, 0x44, 0x04, 0x04, 0x08, 0x10, 0x20, 0x40, 0x7C, 0x00,   // 50 '2'
    7, 0x00, 0x00, 0x38, 0x44, 0x04, 0x04, 0x18, 0x04, 0x04, 0x44, 0x38, 0x00,   // 51 '3'
    7, 0x00, 0x00, 0x08, 0x18, 0x18, 0x28, 0x28, 0x48, 0x7C, 0x08, 0x08, 0x00,   // 52 '4'
    7, 0x00, 0x00, 0x7C, 0x40, 0x40, 0x78, 0x44, 0x04, 0x04, 0x44, 0x38, 0x00,   // 53 '5'
    7, 0x00, 0x00, 0x38, 0x44, 0x40, 0x40, 0x78, 0x44, 0x44, 0x44, 0x38, 0x00,   // 54 '6'
    7, 0x00, 0x00, 0x7C, 0x04, 0x08, 0x08, 0x10, 0x10, 0x20, 0x20, 0x20, 0x00,   // 55 '7'
    7, 0x00, 0x00, 0x38, 0x44, 0x44, 0x44, 0x38, 0x44, 0x44, 0x44, 0x38, 0x00,   // 56 '8'
    7, 0x00, 0x00, 0x38, 0x44, 0x44, 0x44, 0x3C, 0x04, 0x04, 0x44, 0x38, 0x00,   // 57 '9'
    4, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00,   // 58 ':'
    4, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x00, 0x20, 0x40,   // 59 ';'
    7, 0x00, 0x00, 0x00, 0x00, 0x08, 0x10, 0x20, 0x40, 0x20, 0x10, 0x08, 0x00,   // 60 '<'
    7, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7C, 0x00, 0x7C, 0x00, 0x00, 0x00,   // 61 '='
    7, 0x00, 0x00, 0x00, 0x00, 0x40, 0x20, 0x10, 0x08, 0x10, 0x20, 0x40, 0x00,   // 62 '>'
    7, 0x00, 0x00, 0x38, 0x44, 0x04, 0x04, 0x08, 0x10, 0x10, 0x00, 0x10, 0x00,   // 63 '?'
    8, 0x00, 0x00, 0x0C, 0x32, 0x21, 0x4D, 0x53, 0x52, 0x4C, 0x20, 0x31, 0x0E,   // 64 '@'
    8, 0x00, 0x00, 0x10, 0x10, 0x28, 0x28, 0x44, 0x44, 0x7C, 0x82, 0x82, 0x00,   // 65 'A'
    8, 0x00, 0x00, 0x78, 0x44, 0x44, 0x44, 0x78, 0x44, 0x44, 0x44, 0x78, 0x00,   // 66 'B'
    8, 0x00, 0x00, 0x3C, 0x42, 0x40, 0x40, 0x40, 0x40, 0x40, 0x42, 0x3C, 0x00,   // 67 'C'
    8, 0x00, 0x00, 0x78, 0x44, 0x42, 0x42, 0x42, 0x42, 0x42, 0x44, 0x78, 0x00,   // 68 'D'
    8, 0x00, 0x00, 0x7C, 0x40, 0x40, 0x40, 0x78, 0x40, 0x40, 0x40, 0x7C, 0x00,   // 69 'E'
    7, 0x00, 0x00, 0x7C, 0x40, 0x40, 0x40, 0x78, 0x40, 0x40, 0x40, 0x40, 0x00,   // 70 'F'
    8, 0x00, 0x00, 0x3C, 0x42, 0x40, 0x40, 0x4E, 0x42, 0x42, 0x46, 0x3A, 0x00,   // 71 'G'
    8, 0x00, 0x00, 0x42, 0x42, 0x42, 0x42, 0x7E, 0x42, 0x42, 0x42, 0x42, 0x00,   // 72 'H'
    4, 0x00, 0x00, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x00,   // 73 'I'
    6, 0x00, 0x00, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x90, 0x90, 0x60, 0x00,   // 74 'J'
    8, 0x00, 0x00, 0x44, 0x48, 0x50, 0x60, 0x60, 0x50, 0x48, 0x44, 0x42, 0x00,   // 75 'K'
    7, 0x00, 0x00, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x7C, 0x00,   // 76 'L'
    8, 0x00, 0x00, 0x41, 0x41, 0x63, 0x63, 0x55, 0x55, 0x49, 0x49, 0x41, 0x00,   // 77 'M'
    8, 0x00, 0x00, 0x42, 0x62, 0x62, 0x52, 0x52, 0x4A, 0x46, 0x46, 0x42, 0x00,   // 78 'N'
    8, 0x00, 0x00, 0x3C, 0x42, 0x42, 0x42, 0x42, 0x42, 0x42, 0x42, 0x3C, 0x00,   // 79 'O'
    8, 0x00, 0x00, 0x7C, 0x42, 0x42, 0x42, 0x7C, 0x40, 0x40, 0x40, 0x40, 0x00,   // 80 'P'
    8, 0x00, 0x00, 0x3C, 0x42, 0x42, 0x42, 0x42, 0x42, 0x4A, 0x46, 0x3C, 0x02,   // 81 'Q'
    8, 0x00, 0x00, 0x7C, 0x42, 0x42, 0x42, 0x7C, 0x42, 0x42, 0x42, 0x42, 0x00,   // 82 'R'
    8, 0x00, 0x00, 0x38, 0x44, 0x40, 0x40, 0x38, 0x04, 0x04, 0x44, 0x38, 0x00,   // 83 'S'
    8, 0x00, 0x00, 0x7C, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x00,   // 84 'T'
    8, 0x00, 0x00, 0x42, 0x42, 0x42, 0x42, 0x42, 0x42, 0x42, 0x42, 0x3C, 0x00,   // 85 'U'
    8, 0x00, 0x00, 0x41, 0x41, 0x22, 0x22, 0x22, 0x14, 0x14, 0x08, 0x08, 0x00,   // 86 'V'
    8, 0x00, 0x00, 0x41, 0x41, 0x41, 0x22, 0x2A, 0x2A, 0x1C, 0x14, 0x14, 0x00,   // 87 'W'
    8, 0x00, 0x00, 0x41, 0x41, 0x22, 0x14, 0x08, 0x14, 0x22, 0x41, 0x41, 0x00,   // 88 'X'
    8, 0x00, 0x00, 0x41, 0x41, 0x22, 0x14, 0x08, 0x08, 0x08, 0x08, 0x08, 0x00,   // 89 'Y'
    8, 0x00, 0x00, 0x7F, 0x01, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x7F, 0x00,   // 90 'Z'
    4, 0x00, 0x00, 0x60, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40,   // 91 '['
    6, 0x00, 0x00, 0x40, 0x40, 0x40, 0x20, 0x20, 0x10, 0x10, 0x08, 0x08, 0x00,   // 92 '\'
    4, 0x00, 0x00, 0x60, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,   // 93 ']'
    7, 0x00, 0x10, 0x28, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,   // 94 '^'
    7, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,   // 95 '_'
    4, 0x00, 0x00, 0x40, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,   // 96 '`'
    7, 0x00, 0x00, 0x00, 0x00, 0x00, 0x38, 0x04, 0x3C, 0x44, 0x44, 0x3C, 0x00,   // 97 'a'
    7, 0x00, 0x00, 0x40, 0x40, 0x40, 0x78, 0x44, 0x44, 0x44, 0x44, 0x78, 0x00,   // 98 'b'
    7, 0x00, 0x00, 0x00, 0x00, 0x00, 0x38, 0x44, 0x40, 0x40, 0x44, 0x38, 0x00,   // 99 'c'
    7, 0x00, 0x00, 0x04, 0x04, 0x04, 0x3C, 0x44, 0x44, 0x44, 0x44, 0x3C, 0x00,   // 100 'd'
    7, 0x00, 0x00, 0x00, 0x00, 0x00, 0x38, 0x44, 0x7C, 0x40, 0x44, 0x38, 0x00,   // 101 'e'
    4, 0x00, 0x00, 0x20, 0x40, 0x40, 0x60, 0x40, 0x40, 0x40, 0x40, 0x40, 0x00,   // 102 'f'
    7, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3C, 0x44, 0x44, 0x44, 0x44, 0x3C, 0x04,   // 103 'g'
    7, 0x00, 0x00, 0x40, 0x40, 0x40, 0x58, 0x64, 0x44, 0x44, 0x44, 0x44, 0x00,   // 104 'h'
    3, 0x00, 0x00, 0x40, 0x00, 0x00, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x00,   // 105 'i'
    3, 0x00, 0x00, 0x40, 0x00, 0x00, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40,   // 106 'j'
    7, 0x00, 0x00, 0x40, 0x40, 0x40, 0x48, 0x50, 0x60, 0x50, 0x48, 0x44, 0x00,   // 107 'k'
    3, 0x00, 0x00, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x00,   // 108 'l'
    9, 0x00, 0x00, 0x00, 0x00, 0x00, 0x76, 0x49, 0x49, 0x49, 0x49, 0x49, 0x00,   // 109 'm'
    7, 0x00, 0x00, 0x00, 0x00, 0x00, 0x58, 0x64, 0x44, 0x44, 0x44, 0x44, 0x00,   // 110 'n'
    7, 0x00, 0x00, 0x00, 0x00, 0x00, 0x38, 0x44, 0x44, 0x44, 0x44, 0x38, 0x00,   // 111 'o'
    7, 0x00, 0x00, 0x00, 0x00, 0x00, 0x78, 0x44, 0x44, 0x44, 0x44, 0x78, 0x40,   // 112 'p'
    7, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3C, 0x44, 0x44, 0x44, 0x44, 0x3C, 0x04,   // 113 'q'
    4, 0x00, 0x00, 0x00, 0x00, 0x00, 0x60, 0x40, 0x40, 0x40, 0x40, 0x40, 0x00,   // 114 'r'
    6, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x48, 0x20, 0x10, 0x48, 0x30, 0x00,   // 115 's'
    4, 0x00, 0x00, 0x00, 0x40, 0x40, 0x60, 0x40, 0x40, 0x40, 0x40, 0x20, 0x00,   // 116 't'
    7, 0x00, 0x00, 0x00, 0x00, 0x00, 0x44, 0x44, 0x44, 0x44, 0x4C, 0x34, 0x00,   // 117 'u'
    7, 0x00, 0x00, 0x00, 0x00, 0x00, 0x44, 0x44, 0x28, 0x28, 0x10, 0x10, 0x00,   // 118 'v'
    8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x49, 0x49, 0x55, 0x55, 0x22, 0x22, 0x00,   // 119 'w'
    6, 0x00, 0x00, 0x00, 0x00, 0x00, 0x48, 0x48, 0x30, 0x30, 0x48, 0x48, 0x00,   // 120 'x'
    6, 0x00, 0x00, 0x00, 0x00, 0x00, 0x48, 0x48, 0x48, 0x48, 0x30, 0x20, 0x20,   // 121 'y'
    6, 0x00, 0x00, 0x00, 0x00, 0x00, 0x78, 0x08, 0x10, 0x20, 0x40, 0x78, 0x00,   // 122 'z'
    5, 0x00, 0x10, 0x20, 0x20, 0x20, 0x20, 0x40, 0x20, 0x20, 0x20, 0x20, 0x10,   // 123 '{'
    3, 0x00, 0x00, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40,   // 124 '|'
    5, 0x00, 0x40, 0x20, 0x20, 0x20, 0x20, 0x10, 0x20, 0x20, 0x20, 0x20, 0x40,   // 125 '}'
    8, 0x00, 0x00, 0x00, 0x32, 0x4C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,   // 126 '~'
    4, 0x00, 0x00, 0x00, 0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x60    // 127 ''
#END


// global variables
var screenwidth, screenheight;
var xc, yc;
var seconds, minutes, hours;
var day, month, year;
var msgCounter;
var currentMsg;
var ampm;

// draw digital clock
func drawClock()
    var clockY;
    var clockX;

    clockY := 20;
    clockX := xc;

    // Clear clock area
    //gfx_RectangleFilled(10, clockY - 2, screenwidth - 10, clockY + 20, BLACK);
    gfx_Rectangle(10, clockY - 2, screenwidth - 12, clockY + 20, CYAN);

    // Draw time
    txt_Set(FONT_ID, MS_SanSerif8x12);
    txt_FGcolour(WHITE);

    gfx_MoveTo(clockX - 30, clockY + 2);

    txt_Bold(ON);
    // Hours
    if (hours < 10)
        print("0", [DEC] hours);
    else
        print([DEC] hours);
    endif

    print(":");

    txt_Bold(ON);
    // Minutes with leading zero
    if (minutes < 10)
        print("0", [DEC] minutes);
    else
        print([DEC] minutes);
    endif

    print(":");

    // Seconds with leading zero
    if (seconds < 10)
        print("0", [DEC] seconds);
    else
        print([DEC] seconds);
    endif

    // Draw AM/PM
    txt_Bold(OFF);
    print(" ", [STR] ampm);
endfunc

// draw date
func drawDate()
    var dateY;
    var dateX;

    dateY := 50;
    dateX := xc;

    // Clear date area
    gfx_RectangleFilled(10, dateY - 2, screenwidth - 10, dateY + 12, BLACK);

    txt_FGcolour(YELLOW);
    txt_Bold(OFF);
    gfx_MoveTo(dateX - 35, dateY + 2);

    // Day with leading zero
    if (day < 10)
        print("0", [DEC] day);
    else
        print([DEC] day);
    endif

    print("/");

    // Month with leading zero
    if (month < 10)
        print("0", [DEC] month);
    else
        print([DEC] month);
    endif

    print("/", [DEC] year);
endfunc

// draw centered message
func drawMessage(var msg)
    var msgY;
    var msgX;
    var w;

    msgY := 75;

    //gfx_Cls();
    // Clear message area
    gfx_RectangleFilled(1, msgY, screenwidth - 2, msgY + 12, BLACK);

    txt_FGcolour(CYAN);
    txt_BGcolour(BLACK);
    txt_Bold(ON);

    // Draw message based on msg parameter
    if (msg == 0)
        w := 16 * 6;
        msgX := xc - (w / 2);
        gfx_MoveTo(msgX, msgY);
        print("I love you baby!");
    endif

    if (msg == 1)
        w := 16 * 6;
        msgX := xc - (w / 2);
        gfx_MoveTo(msgX, msgY);
        print("You are my love");
    endif

    if (msg == 2)
        w := 16 * 6;
        msgX := xc - (w / 2);
        gfx_MoveTo(msgX, msgY);
        print("You're beautiful");
    endif

    if (msg == 3)
        w := 14 * 6;
        msgX := xc - (w / 2);
        gfx_MoveTo(msgX, msgY);
        print("Keep smiling :)");
    endif

    if (msg == 4)
        w := 18 * 6;
        msgX := xc - (w / 2);
        gfx_MoveTo(msgX, msgY);
        print("Sauce on the side");
    endif

    if (msg == 5)
        w := 18 * 6;
        msgX := xc - (w / 2);
        gfx_MoveTo(msgX, msgY);
        print("Bitches love cake");
    endif

    txt_Bold(OFF);
endfunc

// draw decorative elements
func drawDecoration()
    var i;
    var x;

    // Draw decorative dots at bottom
    i := 0;
    x := 23;
    while (i < 5)
        if (i % 2 == 0)
            gfx_CircleFilled(x, 105, 2, YELLOW);
        else
            gfx_CircleFilled(x, 105, 2, CYAN);
        endif
        x := x + 20;
        i := i + 1;
    wend
endfunc

// draw decorative elements
func drawDecoration2()
    var i;
    var x;

    // Draw decorative dots at bottom
    i := 0;
    x := 23;
    while (i < 5)
        if (i % 2 == 0)
            gfx_CircleFilled(x, 105, 2, CYAN);
        else
            gfx_CircleFilled(x, 105, 2, YELLOW);
        endif
        x := x + 20;
        i := i + 1;
    wend
endfunc

func main()
    var t, exit;

    // set initial time
    minutes := 46;
    seconds := 45;
    hours   := 01;

    // set initial date
    day := 28;
    month := 11;
    year := 2025;

    ampm := "AM";

    exit    := 0;
    msgCounter := 0;
    currentMsg := 0;

    gfx_Cls();

    // get the screen resolution and centrepoint
    screenwidth := peekB( GFX_XMAX ) + 1;
    screenheight := peekB( GFX_YMAX ) + 1;
    xc := screenwidth >> 1;
    yc := screenheight >> 1;

    gfx_Cls();

    // Draw border
    gfx_Rectangle(0, 0, screenwidth-1, screenheight-1, RED);

    // Draw initial display
    drawClock();
    drawDate();
    drawMessage(currentMsg);
    drawDecoration();

    // Main loop - update every second
    repeat

        t := peekW(SYSTEM_TIMER_LO) + 1000;      // capture the system timer and add 1sec delay value

        // calculate the new time
        seconds := seconds + 1;
        if (seconds >= 60)
            seconds := 0;
            minutes := minutes + 1;
            if (minutes >= 60)
                minutes := 0;
                hours := hours + 1;
                if (hours > 12)
                    hours := 1;
                endif
                if (hours == 12)
                    if (ampm == "AM")
                        ampm := "PM";
                    else
                        ampm := "AM";
                    endif
                endif
            endif
        endif

        // Update display
        drawClock();

        // Change message every 10 seconds
        msgCounter := msgCounter + 1;
        if (msgCounter >= 5)
            msgCounter := 0;
            currentMsg := currentMsg + 1;
            if (currentMsg > 5) currentMsg := 0;
            drawMessage(currentMsg);
            if (currentMsg == 0) drawDecoration();
            if (currentMsg == 1) drawDecoration2();
            if (currentMsg == 2) drawDecoration();
            if (currentMsg == 3) drawDecoration2();
            if (currentMsg == 4) drawDecoration();
            if (currentMsg == 5) drawDecoration2();
        endif

        // run fast if FIRE pressed
        if(joystick() == FIRE)
            pause(10);
        else
            while(peekW(SYSTEM_TIMER_LO) != t);
        endif

    until(exit == 1);

endfunc
